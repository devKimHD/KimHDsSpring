<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.myex01.mappers.board2">
	<select id="getTime" resultType="string">
		select sysdate from dual
	</select>

	<select id="list" resultType="Board2Vo">
		select * from
		(select rownum rnum, a.* from
		(select * from tbl_board2
		<include refid="search"></include>
		order by re_group desc, re_seq asc)
		a)
		where rnum between #{startRow} and #{endRow}
	</select>

	<insert id="insert">
		insert into tbl_board2 (bno, title, content, writer,re_group)
		values
		(seq_board2_bno.nextval, #{title}, #{content, jdbcType=VARCHAR}, #{writer}
		, seq_board2_bno.nextval)
	</insert>

	<select id="read" resultType="Board2Vo">
		select * from tbl_board2 where bno=#{bno}
	</select>

	<update id="update">
		update tbl_board2 set title=#{title}, content=#{content, jdbcType=VARCHAR},
		writer=#{writer} where bno=#{bno}
	</update>

	<delete id="delete">
		delete from tbl_board2 where bno=#{bno}
	</delete>

	<select id="boardCount" resultType="string">
		select count(*) from tbl_board2
		<include refid="search"></include>
	</select>
	
	<insert id="insertReply">
		insert into tbl_board2 (bno, title, content, writer,re_group,re_level,re_seq)
		values
		(seq_board2_bno.nextval, #{title}, #{content, jdbcType=VARCHAR}, #{writer}
		,#{re_group}, #{re_level}+1, #{re_seq}+1)
	</insert>
	
	<update id="updateReply">
		<![CDATA[
		update tbl_board2 set re_seq=re_seq+1
		where re_group = #{re_group}
		and re_seq > #{re_seq} 
		]]>
	</update>
	<sql id="search">
		<if test="searchType != null and keyword != null">
			<choose>
				<when test='searchType =="t"'>
					where title like '%' || #{keyword} || '%'
				</when>

				<when test='searchType =="c"'>
					where content like '%' || #{keyword} || '%'
				</when>

				<when test='searchType =="w"'>
					where writer like '%' || #{keyword} || '%'
				</when>

				<when test='searchType =="tc"'>
					where title like '%' || #{keyword} || '%'
					or
					content like '%' || #{keyword} || '%'
				</when>

				<when test='searchType =="tcw"'>
					where title like '%' || #{keyword} || '%'
					or
					content like '%' || #{keyword} || '%'
					or
					writer like '%' || #{keyword} || '%'
				</when>
			</choose>
		</if>
	</sql>
</mapper>